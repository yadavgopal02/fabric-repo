name: Create PR from dev to uat

on:
  push:
    branches:
      - dev

jobs:
  create_pr_from_dev_to_uat:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        
      - name: Generate Random Title
        id: random_title
        run: echo "::set-output name=title::Automated PR from dev to uat $(shuf -i 1-1000 -n 1)"

      - name: Open PR from dev to uat
        if: github.event_name == 'push' && github.ref == 'refs/heads/dev'
        run: |
          response=$(curl -X POST \
          -H "Authorization: Bearer ${{ secrets.PERSONAL_ACCESS_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/repos/${{ github.repository }}/pulls \
          -d '{
            "title": "${{ steps.random_title.outputs.title }}",
            "body": "Automatically generated pull request from dev to uat",
            "head": "dev",
            "base": "uat",
            "requested_reviewers": ['yadavgopal', 'ravip333'],
            "assignee": 'ravip333'
          }')
          echo "$response"
